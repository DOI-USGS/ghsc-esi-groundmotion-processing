#!/usr/bin/env python

import os
import shutil
import argparse
import pkg_resources
import logging

from gmprocess.config import CONFIG_FILE
from gmprocess.logging import setup_logger
from gmprocess.args import add_shared_args


def main(args):
    setup_logger(args)
    logging.info("Running gmsetup.")

    home_path = os.path.expanduser("~")
    install_path = os.path.join(home_path, ".gmprocess")
    data_path = pkg_resources.resource_filename('gmprocess', 'data/')
    install_conf_path = os.path.join(install_path, CONFIG_FILE)
    data_conf_path = os.path.join(data_path, CONFIG_FILE)

    # Does the install dir exist?
    if not os.path.exists(install_path):
        os.makedirs(install_path)

    # Does a conf file already exist?
    if not os.path.exists(install_conf_path):
        # Copy from data dir
        logging.info("No existing config found, installing config file...")
        shutil.copy2(data_conf_path, install_conf_path)
    else:
        # Load installed config
        logging.warning('Existing config file found. Nothing to do.')


if __name__ == '__main__':
    description = 'Setup gmprocess config files.'
    parser = argparse.ArgumentParser(description=description)

    # Shared arguments
    parser = add_shared_args(parser)

    pargs = parser.parse_args()
    main(pargs)
