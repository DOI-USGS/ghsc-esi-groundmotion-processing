#!/usr/bin/env python

import os
import shutil
import argparse
import pkg_resources
import logging

from gmprocess.constants import CONFIG_FILE
from gmprocess.logging import setup_logger
from gmprocess.args import add_shared_args


def main(args):
    setup_logger(args)
    logging.info("Running gmsetup.")

    home_path = os.path.expanduser("~")
    data_path = pkg_resources.resource_filename('gmprocess', 'data/')
    install_conf_path = os.path.join(home_path, CONFIG_FILE)
    data_conf_path = os.path.join(data_path, 'config.yml')

    # Does a conf file already exist?
    if not os.path.exists(install_conf_path):
        # Copy from data dir
        logging.info("No existing config found, installing config file...")
        print('data_conf_path: %s' % data_conf_path)
        print('install_conf_path: %s' % install_conf_path)
        shutil.copy2(data_conf_path, install_conf_path)
    else:
        # Load installed config
        logging.warning('Existing config file found. Nothing to do.')


if __name__ == '__main__':
    description = 'Setup gmprocess config files.'
    parser = argparse.ArgumentParser(description=description)

    # Shared arguments
    parser = add_shared_args(parser)

    pargs = parser.parse_args()
    main(pargs)
